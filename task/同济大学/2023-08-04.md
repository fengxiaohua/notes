容器镜像化处理

krakend plugin 镜像化处理
测试gitlab 发布镜像

周末 正式环境更新
krakend 升级
krakend plugin 升级
krakend resp 记录


image: docker:stable

stages:
  - build-keycloak
  - deploy

build-job1:
  stage: build-keycloak
  script:
    - echo "Building build-keycloak..."
    - cd ./keycloak
    - docker build -t git.tongji.edu.cn/keycloak:$CI_COMMIT_TAG .
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD git.tongji.edu.cn
    - docker push git.tongji.edu.cn/keycloak:$CI_COMMIT_TAG
  only:
    - tags

deploy:
  image: ringcentral/sshpass
  stage: deploy
  script:
    - echo "Deploy ..."
    - "sshpass -p 'CSC97Ugczp8muraX' ssh -o StrictHostKeyChecking=no -t $USER@$IPADDRESS 'cd /home/Open-Platform; docker-compose up -d; docker start $(docker ps -aq)'"
  only:
    - tags

