容器镜像化

grafana:
    image: grafana/grafana:9.4.3 # influxdb:1.8
    container_name: grafana
    volumes:
      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards
      - ./grafana/datasources:/etc/grafana/provisioning/datasources
      - ./grafana/grafana.ini:/etc/grafana/grafana.ini
      - grafana-data:/var/lib/grafana
    ports:
      - "3003:3000"

  influxdb:
    image: influxdb:1.8 # influxdb:1.8
    environment:
      - "INFLUXDB_DB=krakend"
      - "INFLUXDB_USER=krakend-dev"
      - "INFLUXDB_USER_PASSWORD=pas5w0rd"
      - "INFLUXDB_ADMIN_USER=admin"
      - "INFLUXDB_ADMIN_PASSWORD=supersecretpassword"
    ports:
      - "8086:8086"

krakend_ce:
    image: devopsfaith/krakend/plugin:0.1 # devopsfaith/krakend:2.4.2
    privileged: true
    volumes:
      - ./krakend:/etc/krakend
    ports:
      - "1234:1234"
      - "127.0.0.1:8080:8080"
      - "8090:8090"
    depends_on:
      - fake_api
      - jaeger
      - keycloak

keycloak:
    build:
      context: ./keycloak
    image: keycloak:16.1.1-tjidp-all4u # jboss/keycloak:16.1.1
    container_name: keycloak
    depends_on:
      - keycloak-db
    ports:
      - "8403:8080" # expose to host port 8403
    environment:
      DB_VENDOR: POSTGRES
      DB_ADDR: keycloak-db
      DB_PORT: 5432
      DB_DATABASE: keycloak
      DB_USER: keycloak
      DB_PASSWORD: password
      KEYCLOAK_USER: admin
      KEYCLOAK_PASSWORD: admin
      # 用于keycloak调试
      # KEYCLOAK_LOGLEVEL: DEBUG

nginx:
    image: nginx:latest # nginx:1.21
    ports:
      - "80:80"
      - "443:443"
    volumes:
      #这个路径./是相对路径 docker-compose文件夹的对应未知
      - ./nginx/:/etc/nginx/conf.d
      - ./docs/:/home/docs
      - ./app/:/home/app